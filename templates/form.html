{% extends "base.html" %}

{% block extra_head %}
    <!-- Additional CSS for form styling and print formatting -->
    <style>
        @media print {
            .no-print {
                display: none;
            }
            .form-section {
                page-break-inside: avoid;
            }
            body {
                font-size: 12pt;
            }
            /* Special print styles for the official form */
            .official-form {
                border: 1px solid #000;
                padding: 0;
                margin: 0;
                width: 210mm; /* A4 width */
                min-height: 297mm; /* A4 height */
            }
            .form-field input, .form-field textarea {
                border: none;
                border-bottom: 1px solid #444;
                background: transparent;
            }
            /* Hide buttons when printing */
            .form-actions {
                display: none;
            }
        }
        
        /* Override header styles for perfect centering */
        .header-table {
            width: 100%;
            table-layout: fixed;
        }
        
        .title-cell {
            text-align: center !important;
        }
        
        .university-title  {
            text-align: center !important;
            align-items: center !important;
            margin: 5px auto !important;
            width: 100% !important;
        }
        
        /* Title specific adjustments */
        .university-name, .school-name, .department-name, .school-address {
            text-align: center !important;
            width: 100% !important;
            display: block !important;
        }
    </style>
{% endblock %}

{% block content %}
<div class="official-form-container">
    <!-- Official form that matches the provided image -->
    <div class="official-form">
        <!-- University Header with logo and title -->
        <div class="form-header">
            <div class="university-logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="UCAD Logo" class="logo-img">
            </div>
            <div class="university-title">
                <p class="university-name">Université Cheikh Anta Diop de Dakar</p>
                <p class="school-name">ECOLE SUPERIEURE POLYTECHNIQUE</p>
                <p class="department-name">DEPARTEMENT GENIE INFORMATIQUE</p>
                <p class="school-address">B.P. 15915 Dakar-Fann (SENEGAL)</p>
            </div>
        </div>

        <!-- Form Title -->
        <div class="form-title">
            <h2>REPONSE POUR STAGE DE FIN DE CYCLE DU DIPLOME UNIVERSITAIRE<br>DE TECHNOLOGIE EN INFORMATIQUE</h2>
            <p class="form-subtitle">- Année 2025 -</p>
        </div>

        <!-- Form Fields -->
        <form method="POST" action="{{ url_for('submit_form') }}" class="internship-form">
            {{ form.csrf_token }}
            
            <!-- Company Information Section -->
            <div class="form-section">
                <div class="form-field">
                    <label for="company_name">ENTREPRISE :</label>
                    {{ form.company_name(class="form-control") }}
                    {% if form.company_name.errors %}
                        <div class="form-errors">
                            {% for error in form.company_name.errors %}
                                <span class="error-message">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-field">
                    <label for="company_address">Adresse :</label>
                    {{ form.company_address(class="form-control") }}
                    {% if form.company_address.errors %}
                        <div class="form-errors">
                            {% for error in form.company_address.errors %}
                                <span class="error-message">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-field contact-row">
                    <div class="contact-item">
                        <label for="contact_phone">Téléphone :</label>
                        {{ form.contact_phone(class="form-control") }}
                        {% if form.contact_phone.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_phone.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="contact-item">
                        <label for="contact_fax">Télécopie :</label>
                        {{ form.contact_fax(class="form-control") }}
                        {% if form.contact_fax.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_fax.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="contact-item">
                        <label for="contact_email">Email :</label>
                        {{ form.contact_email(class="form-control") }}
                        {% if form.contact_email.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_email.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Contact Person Information Section -->
            <div class="form-section">
                <h3>Contact dans l'Entreprise</h3>
                
                <div class="form-field">
                    <label for="contact_name">NOM :</label>
                    {{ form.contact_name(class="form-control") }}
                    {% if form.contact_name.errors %}
                        <div class="form-errors">
                            {% for error in form.contact_name.errors %}
                                <span class="error-message">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-field">
                    <label for="contact_position">Fonction :</label>
                    {{ form.contact_position(class="form-control") }}
                    {% if form.contact_position.errors %}
                        <div class="form-errors">
                            {% for error in form.contact_position.errors %}
                                <span class="error-message">{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                
                <div class="form-field contact-row">
                    <div class="contact-item">
                        <label for="contact_phone_direct">Téléphone :</label>
                        {{ form.contact_phone_direct(class="form-control") }}
                        {% if form.contact_phone_direct.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_phone_direct.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="contact-item">
                        <label for="contact_fax_direct">Télécopie :</label>
                        {{ form.contact_fax_direct(class="form-control") }}
                        {% if form.contact_fax_direct.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_fax_direct.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="contact-item">
                        <label for="contact_email_direct">Email :</label>
                        {{ form.contact_email_direct(class="form-control") }}
                        {% if form.contact_email_direct.errors %}
                            <div class="form-errors">
                                {% for error in form.contact_email_direct.errors %}
                                    <span class="error-message">{{ error }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Student Information Section -->
            <div class="form-section">
                <div class="form-field student-row">
                    <label for="accepts_student">Accepte d'accueillir :</label>
                    <div class="student-fields">
                        <div class="student-item">
                            <label for="student_name">Nom :</label>
                            {{ form.student_name(class="form-control") }}
                        </div>
                        <div class="student-item">
                            <label for="student_firstname">Prénoms :</label>
                            {{ form.student_firstname(class="form-control") }}
                        </div>
                    </div>
                </div>
                
                <!-- Department Information -->
                <div class="department-table">
                    <table>
                        <tr>
                            <th>Filière :</th>
                            <th>INFORMATIQUE</th>
                            <th>DIPLÔME UNIVERSITAIRE DE TECHNOLOGIE EN INFORMATIQUE</th>
                        </tr>
                        <tr>
                            <td>Nombre de positions de stages envisagées :</td>
                            <td colspan="2">
                                {{ form.internship_positions(class="form-control") }}
                            </td>
                        </tr>
                    </table>
                </div>
                
                <!-- Internship Topics -->
                <div class="form-field">
                    <label for="internship_topics">Sujets de stages proposés (à titre indicatif) :</label>
                    <ol>
                        <li>{{ form.internship_topic1(class="form-control") }}</li>
                        <li>{{ form.internship_topic2(class="form-control") }}</li>
                        <li>{{ form.internship_topic3(class="form-control") }}</li>
                    </ol>
                </div>
                
                <!-- Meeting Preferences -->
                <div class="form-field meeting-options">
                    <div class="meeting-option">
                        {{ form.wants_meeting(class="form-checkbox") }}
                        <label for="wants_meeting">Souhaite rencontrer un membre du département pour plus d'informations</label>
                    </div>
                    <div class="meeting-option">
                        {{ form.cannot_accept(class="form-checkbox") }}
                        <label for="cannot_accept">Ne peut donner suite à la demande</label>
                    </div>
                </div>
                
                <!-- Signature Section -->
                <div class="form-field signature-section">
                    <div class="date-field">
                        <label for="signature_date">Fait à :</label>
                        {{ form.signature_location(class="form-control") }}
                    </div>
                    <div class="signature-field">
                        <span>Signature et Cachet</span>
                        <div class="signature-box"></div>
                    </div>
                </div>
            </div>
        </form>

        <!-- Form Footer - Moved outside the form but still inside the official-form -->
        <div class="form-footer">
            <div class="left-footer">ESP · BP 15915 Dakar-Fann</div>
            <div class="right-footer">Téléphone : 33 825 75 28</div>
        </div>
    </div>
</div>

<!-- Form Actions (outside of the form, will be hidden in print) -->
<div class="form-actions no-print">
    <button type="submit" form="internship-form" class="btn btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        {{ form.submit.label.text }}
    </button>
    <button type="button" class="btn btn-secondary" onclick="window.print()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
            <polyline points="6 9 6 2 18 2 18 9"></polyline>
            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
            <rect x="6" y="14" width="12" height="8"></rect>
        </svg>
        Imprimer le formulaire
    </button>
    <button type="reset" form="internship-form" class="btn btn-outline">Réinitialiser</button>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Form validation and interaction
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('.internship-form');
        
        // Set id on the form to connect buttons outside the form
        form.id = 'internship-form';
        
        // Handle print button
        const printButton = document.querySelector('button[onclick="window.print()"]');
        if (printButton) {
            printButton.addEventListener('click', function() {
                // Prepare form for printing (add any needed classes)
                document.body.classList.add('printing');
                
                // Print the document
                window.print();
                
                // Remove print preparation classes
                document.body.classList.remove('printing');
            });
        }
    });
</script>
{% endblock %} 